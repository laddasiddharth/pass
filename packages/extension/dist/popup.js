var g=document.getElementById("unlock-screen"),w=document.getElementById("vault-screen"),I=document.getElementById("add-password-screen"),D=document.getElementById("unlock-form"),P=document.getElementById("user-id"),o=document.getElementById("master-password"),T=document.getElementById("unlock-btn"),B=document.getElementById("unlock-loading"),u=document.getElementById("unlock-error"),V=document.getElementById("lock-btn"),M=document.getElementById("search-input"),k=document.getElementById("vault-list"),h=document.getElementById("empty-state"),F=document.getElementById("add-password-btn"),N=document.getElementById("back-btn"),d=document.getElementById("add-password-form"),y=document.getElementById("site-name"),S=document.getElementById("site-url"),C=document.getElementById("username"),i=document.getElementById("password"),A=document.getElementById("notes"),v=document.getElementById("toggle-password"),O=document.getElementById("generate-password"),m=document.getElementById("add-error"),l=d?.querySelector('button[type="submit"]'),c=[],_="",L=null;async function q(){let e=await f({type:"GET_STATUS"});e&&!e.isLocked?(await H(),r("vault")):r("unlock"),setInterval(()=>{chrome.runtime.sendMessage({type:"HEARTBEAT"}).catch(()=>{})},1e4);let t=await chrome.storage.local.get(["userId"]);t.userId&&(P&&(P.value=t.userId),_=t.userId)}function r(e){switch(g&&g.classList.add("hidden"),w&&w.classList.add("hidden"),I&&I.classList.add("hidden"),e){case"unlock":g&&g.classList.remove("hidden"),o&&o.focus();break;case"vault":w&&w.classList.remove("hidden"),M&&M.focus();break;case"add-password":I&&I.classList.remove("hidden"),y&&y.focus();break}}D&&D.addEventListener("submit",async e=>{e.preventDefault();let t=P.value.trim(),s=o.value;if(!t||!s){E(u,"Please enter both User ID and Master Password");return}T&&(T.disabled=!0),B&&B.classList.remove("hidden"),u&&u.classList.add("hidden");try{let n=await f({type:"UNLOCK_VAULT",masterPassword:s,userId:t});n&&n.success?(o&&(o.value=""),_=t,await chrome.storage.local.set({userId:t}),await H(),r("vault")):E(u,n&&n.error||"Failed to unlock vault")}catch(n){E(u,n.message)}finally{T&&(T.disabled=!1),B&&B.classList.add("hidden")}});async function H(){try{let e=await f({type:"GET_VAULT"});e&&e.success?(c=e.vault,x(c)):E(u,e&&e.error||"Failed to load vault")}catch(e){console.error("Failed to load vault:",e)}}function x(e){if(k){if(k.innerHTML="",e.length===0){h&&h.classList.remove("hidden");return}h&&h.classList.add("hidden"),e.forEach((t,s)=>{let n=R(t,s);k.appendChild(n)})}}function R(e,t){let s=document.createElement("div");s.className="vault-item",s.innerHTML=`
    <div class="vault-item-header">
      <div class="vault-item-title">${b(e.siteName)}</div>
      <div class="vault-item-actions">
        <button class="action-btn edit-btn">Edit</button>
        <button class="action-btn delete-btn delete">Delete</button>
        <button class="copy-btn">Copy</button>
      </div>
    </div>
    <div class="vault-item-url">${b(e.siteUrl)}</div>
    <div class="vault-item-username">${b(e.username)}</div>
  `;let n=s.querySelector(".copy-btn");n&&n.addEventListener("click",p=>{p.stopPropagation(),G(e.password,n)});let a=s.querySelector(".edit-btn");a&&a.addEventListener("click",p=>{p.stopPropagation(),K(e)});let U=s.querySelector(".delete-btn");return U&&U.addEventListener("click",p=>{p.stopPropagation(),W(e.id)}),s}async function K(e){L=e.id;let t=document.getElementById("add-password-title");t&&(t.textContent="Edit Password"),y&&(y.value=e.siteName),S&&(S.value=e.siteUrl),C&&(C.value=e.username),i&&(i.value=e.password),A&&(A.value=e.notes||""),r("add-password")}async function W(e){if(confirm("Are you sure you want to delete this password?"))try{let t=await f({type:"DELETE_PASSWORD",entryId:e});t&&t.success?await H():alert(t&&t.error||"Failed to delete password")}catch(t){alert(t.message)}}M&&M.addEventListener("input",e=>{let t=e.target.value.toLowerCase();if(!t){x(c);return}let s=c.filter(n=>n.siteName.toLowerCase().includes(t)||n.siteUrl.toLowerCase().includes(t)||n.username.toLowerCase().includes(t));x(s)});F&&F.addEventListener("click",()=>{L=null;let e=document.getElementById("add-password-title");e&&(e.textContent="Add Password"),d&&d.reset(),r("add-password")});N&&N.addEventListener("click",()=>{r("vault"),d&&d.reset(),m&&m.classList.add("hidden")});d&&d.addEventListener("submit",async e=>{e.preventDefault();let t=l?l.textContent:"Save";l&&(l.disabled=!0,l.textContent="Saving..."),m&&m.classList.add("hidden");let s={id:L||crypto.randomUUID(),siteName:y.value.trim(),siteUrl:S.value.trim(),username:C.value.trim(),password:i.value,notes:A.value.trim(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};try{let a=await f({type:L?"UPDATE_PASSWORD":"ADD_PASSWORD",entry:s});a&&a.success?(d&&d.reset(),L=null,await H(),r("vault")):E(m,a&&a.error||"Failed to save password")}catch(n){E(m,n.message)}finally{l&&(l.disabled=!1,l.textContent=t)}});v&&v.addEventListener("click",()=>{if(!i)return;let e=i.type==="password"?"text":"password";i.type=e,v.textContent=e==="password"?"\u{1F441}\uFE0F":"\u{1F648}"});O&&O.addEventListener("click",()=>{if(!i)return;let e=$();i.value=e,i.type="text",v&&(v.textContent="\u{1F648}")});function $(e=20){let t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()_+-=[]{}|;:,.<>?",s=new Uint8Array(e);crypto.getRandomValues(s);let n="";for(let a=0;a<e;a++)n+=t[s[a]%t.length];return n}V&&V.addEventListener("click",async()=>{await f({type:"LOCK_VAULT"}),c=[],r("unlock"),o&&(o.value="")});chrome.runtime.onMessage.addListener(e=>{e.type==="VAULT_LOCKED"&&(c=[],r("unlock"),o&&(o.value=""))});async function f(e){return new Promise((t,s)=>{chrome.runtime.sendMessage(e,n=>{chrome.runtime.lastError?s(new Error(chrome.runtime.lastError.message)):(n&&n.error==="Vault is locked"&&(console.warn("[Popup] Vault is locked, redirecting to unlock screen"),c=[],r("unlock"),o&&(o.value="")),t(n))})})}function E(e,t){e&&(e.textContent=t,e.classList.remove("hidden"),setTimeout(()=>{e.classList.add("hidden")},5e3))}function b(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}async function G(e,t){try{await navigator.clipboard.writeText(e);let s=t.textContent;t.textContent="\u2713 Copied",t.classList.add("copied"),setTimeout(()=>{t.textContent=s,t.classList.remove("copied")},2e3)}catch(s){console.error("Failed to copy:",s)}}q();
//# sourceMappingURL=popup.js.map

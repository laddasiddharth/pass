var I=document.getElementById("unlock-screen"),T=document.getElementById("register-screen"),B=document.getElementById("vault-screen"),h=document.getElementById("add-password-screen"),G=document.getElementById("unlock-form"),F=document.getElementById("user-id"),i=document.getElementById("master-password"),M=document.getElementById("unlock-btn"),H=document.getElementById("unlock-loading"),f=document.getElementById("unlock-error"),K=document.getElementById("go-to-register"),W=document.getElementById("register-form"),V=document.getElementById("reg-email"),x=document.getElementById("reg-password"),A=document.getElementById("reg-password-confirm"),k=document.getElementById("register-btn"),b=document.getElementById("register-loading"),u=document.getElementById("register-error"),$=document.getElementById("go-to-login"),j=document.getElementById("lock-btn"),S=document.getElementById("search-input"),D=document.getElementById("vault-list"),P=document.getElementById("empty-state"),z=document.getElementById("add-password-btn"),J=document.getElementById("user-display"),Q=document.getElementById("display-user-email"),X=document.getElementById("back-btn"),d=document.getElementById("add-password-form"),v=document.getElementById("site-name"),R=document.getElementById("site-url"),_=document.getElementById("username"),l=document.getElementById("password"),N=document.getElementById("notes"),L=document.getElementById("toggle-password"),Y=document.getElementById("generate-password"),g=document.getElementById("add-error"),c=d?.querySelector('button[type="submit"]'),m=[],C="",y=null;async function Z(){let e=await E({type:"GET_STATUS"});e&&!e.isLocked?(await w(),r("vault")):r("unlock"),setInterval(()=>{chrome.runtime.sendMessage({type:"HEARTBEAT"}).catch(()=>{})},1e4);let t=await chrome.storage.local.get(["userId"]);t.userId&&(F&&(F.value=t.userId),C=t.userId)}function r(e){switch(I&&I.classList.add("hidden"),T&&T.classList.add("hidden"),B&&B.classList.add("hidden"),h&&h.classList.add("hidden"),e){case"unlock":I&&I.classList.remove("hidden"),i&&i.focus();break;case"register":T&&T.classList.remove("hidden"),V&&V.focus();break;case"vault":B&&B.classList.remove("hidden"),J&&J.classList.remove("hidden"),Q&&(Q.textContent=C),S&&S.focus();break;case"add-password":h&&h.classList.remove("hidden"),v&&v.focus();break}}G&&G.addEventListener("submit",async e=>{e.preventDefault();let t=F.value.trim(),s=i.value;if(!t||!s){o(f,"Please enter both User ID and Master Password");return}M&&(M.disabled=!0),H&&H.classList.remove("hidden"),f&&f.classList.add("hidden");try{let n=await E({type:"UNLOCK_VAULT",masterPassword:s,userId:t});n&&n.success?(i&&(i.value=""),C=t,await chrome.storage.local.set({userId:t}),await w(),r("vault")):o(f,n&&n.error||"Failed to unlock vault")}catch(n){o(f,n.message)}finally{M&&(M.disabled=!1),H&&H.classList.add("hidden")}});K&&K.addEventListener("click",e=>{e.preventDefault(),r("register")});$&&$.addEventListener("click",e=>{e.preventDefault(),r("unlock")});W&&W.addEventListener("submit",async e=>{e.preventDefault();let t=V.value.trim(),s=x.value,n=A.value;if(!t||!s||!n){o(u,"Please fill in all fields");return}if(s!==n){o(u,"Passwords do not match");return}if(s.length<8){o(u,"Password must be at least 8 characters");return}k&&(k.disabled=!0),b&&b.classList.remove("hidden"),u&&u.classList.add("hidden");try{let a=await E({type:"REGISTER_USER",email:t,masterPassword:s});a&&a.success?(C=t,await chrome.storage.local.set({userId:t}),x&&(x.value=""),A&&(A.value=""),await w(),r("vault")):o(u,a&&a.error||"Failed to register")}catch(a){o(u,a.message)}finally{k&&(k.disabled=!1),b&&b.classList.add("hidden")}});async function w(){try{let e=await E({type:"GET_VAULT"});e&&e.success?(m=e.vault,O(m)):o(f,e&&e.error||"Failed to load vault")}catch(e){console.error("Failed to load vault:",e)}}function O(e){if(D){if(D.innerHTML="",e.length===0){P&&P.classList.remove("hidden");return}P&&P.classList.add("hidden"),e.forEach((t,s)=>{let n=ee(t,s);D.appendChild(n)})}}function ee(e,t){let s=document.createElement("div");s.className="vault-item",s.innerHTML=`
    <div class="vault-item-header">
      <div class="vault-item-title">${U(e.siteName)}</div>
      <div class="vault-item-actions">
        <button class="action-btn edit-btn">Edit</button>
        <button class="action-btn delete-btn delete">Delete</button>
        <button class="copy-btn">Copy</button>
      </div>
    </div>
    <div class="vault-item-url">${U(e.siteUrl)}</div>
    <div class="vault-item-username">${U(e.username)}</div>
  `;let n=s.querySelector(".copy-btn");n&&n.addEventListener("click",p=>{p.stopPropagation(),ae(e.password,n)});let a=s.querySelector(".edit-btn");a&&a.addEventListener("click",p=>{p.stopPropagation(),te(e)});let q=s.querySelector(".delete-btn");return q&&q.addEventListener("click",p=>{p.stopPropagation(),se(e.id)}),s}async function te(e){y=e.id;let t=document.getElementById("add-password-title");t&&(t.textContent="Edit Password"),v&&(v.value=e.siteName),R&&(R.value=e.siteUrl),_&&(_.value=e.username),l&&(l.value=e.password),N&&(N.value=e.notes||""),r("add-password")}async function se(e){if(confirm("Are you sure you want to delete this password?"))try{let t=await E({type:"DELETE_PASSWORD",entryId:e});t&&t.success?await w():alert(t&&t.error||"Failed to delete password")}catch(t){alert(t.message)}}S&&S.addEventListener("input",e=>{let t=e.target.value.toLowerCase();if(!t){O(m);return}let s=m.filter(n=>n.siteName.toLowerCase().includes(t)||n.siteUrl.toLowerCase().includes(t)||n.username.toLowerCase().includes(t));O(s)});z&&z.addEventListener("click",()=>{y=null;let e=document.getElementById("add-password-title");e&&(e.textContent="Add Password"),d&&d.reset(),r("add-password")});X&&X.addEventListener("click",()=>{r("vault"),d&&d.reset(),g&&g.classList.add("hidden")});d&&d.addEventListener("submit",async e=>{e.preventDefault();let t=c?c.textContent:"Save";c&&(c.disabled=!0,c.textContent="Saving..."),g&&g.classList.add("hidden");let s={id:y||crypto.randomUUID(),siteName:v.value.trim(),siteUrl:R.value.trim(),username:_.value.trim(),password:l.value,notes:N.value.trim(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};try{let a=await E({type:y?"UPDATE_PASSWORD":"ADD_PASSWORD",entry:s});a&&a.success?(d&&d.reset(),y=null,await w(),r("vault")):o(g,a&&a.error||"Failed to save password")}catch(n){o(g,n.message)}finally{c&&(c.disabled=!1,c.textContent=t)}});L&&L.addEventListener("click",()=>{if(!l)return;let e=l.type==="password"?"text":"password";l.type=e,L.textContent=e==="password"?"\u{1F441}\uFE0F":"\u{1F648}"});Y&&Y.addEventListener("click",()=>{if(!l)return;let e=ne();l.value=e,l.type="text",L&&(L.textContent="\u{1F648}")});function ne(e=20){let t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()_+-=[]{}|;:,.<>?",s=new Uint8Array(e);crypto.getRandomValues(s);let n="";for(let a=0;a<e;a++)n+=t[s[a]%t.length];return n}j&&j.addEventListener("click",async()=>{await E({type:"LOCK_VAULT"}),m=[],r("unlock"),i&&(i.value="")});chrome.runtime.onMessage.addListener(e=>{e.type==="VAULT_LOCKED"&&(m=[],r("unlock"),i&&(i.value=""))});async function E(e){return new Promise((t,s)=>{chrome.runtime.sendMessage(e,n=>{chrome.runtime.lastError?s(new Error(chrome.runtime.lastError.message)):(n&&n.error==="Vault is locked"&&(console.warn("[Popup] Vault is locked, redirecting to unlock screen"),m=[],r("unlock"),i&&(i.value="")),t(n))})})}function o(e,t){e&&(e.textContent=t,e.classList.remove("hidden"),setTimeout(()=>{e.classList.add("hidden")},5e3))}function U(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}async function ae(e,t){try{await navigator.clipboard.writeText(e);let s=t.textContent;t.textContent="\u2713 Copied",t.classList.add("copied"),setTimeout(()=>{t.textContent=s,t.classList.remove("copied")},2e3)}catch(s){console.error("Failed to copy:",s)}}Z();
//# sourceMappingURL=popup.js.map

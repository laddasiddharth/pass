var Q=BigInt(4294967295),At=BigInt(32);function xt(e,t=!1){return t?{h:Number(e&Q),l:Number(e>>At&Q)}:{h:Number(e>>At&Q)|0,l:Number(e&Q)|0}}var C=(e,t,r)=>e>>>r|t<<32-r,G=(e,t,r)=>e<<32-r|t>>>r,tt=(e,t,r)=>e<<64-r|t>>>r-32,et=(e,t,r)=>e>>>r-32|t<<64-r,rt=(e,t)=>t,nt=(e,t)=>e;function ht(e,t,r,o){let i=(t>>>0)+(o>>>0);return{h:e+r+(i/2**32|0)|0,l:i|0}}var J=(e,t,r)=>(e>>>0)+(t>>>0)+(r>>>0),W=(e,t,r,o)=>t+r+o+(e/2**32|0)|0;function _t(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function st(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function V(e,...t){if(!_t(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function ft(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function kt(e,t){V(e);let r=t.outputLen;if(e.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function N(e){return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}function H(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function L(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}var Bt=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Lt(e){return e<<24&4278190080|e<<8&16711680|e>>>8&65280|e>>>24&255}var E=Bt?e=>e:e=>Lt(e);function Kt(e){for(let t=0;t<e.length;t++)e[t]=Lt(e[t]);return e}var P=Bt?e=>e:Kt;function Et(e){if(typeof e!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}function R(e){return typeof e=="string"&&(e=Et(e)),V(e),e}function it(e){return typeof e=="string"&&(e=Et(e)),V(e),e}var ot=class{};function Ut(e){let t=(o,i)=>e(i).update(R(o)).digest(),r=e({});return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=o=>e(o),t}var Vt=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]);var m=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),c=new Uint32Array(32);function S(e,t,r,o,i,n){let a=i[n],s=i[n+1],l=c[2*e],u=c[2*e+1],d=c[2*t],h=c[2*t+1],g=c[2*r],w=c[2*r+1],p=c[2*o],y=c[2*o+1],x=J(l,d,a);u=W(x,u,h,s),l=x|0,{Dh:y,Dl:p}={Dh:y^u,Dl:p^l},{Dh:y,Dl:p}={Dh:rt(y,p),Dl:nt(y,p)},{h:w,l:g}=ht(w,g,y,p),{Bh:h,Bl:d}={Bh:h^w,Bl:d^g},{Bh:h,Bl:d}={Bh:C(h,d,24),Bl:G(h,d,24)},c[2*e]=l,c[2*e+1]=u,c[2*t]=d,c[2*t+1]=h,c[2*r]=g,c[2*r+1]=w,c[2*o]=p,c[2*o+1]=y}function T(e,t,r,o,i,n){let a=i[n],s=i[n+1],l=c[2*e],u=c[2*e+1],d=c[2*t],h=c[2*t+1],g=c[2*r],w=c[2*r+1],p=c[2*o],y=c[2*o+1],x=J(l,d,a);u=W(x,u,h,s),l=x|0,{Dh:y,Dl:p}={Dh:y^u,Dl:p^l},{Dh:y,Dl:p}={Dh:C(y,p,16),Dl:G(y,p,16)},{h:w,l:g}=ht(w,g,y,p),{Bh:h,Bl:d}={Bh:h^w,Bl:d^g},{Bh:h,Bl:d}={Bh:tt(h,d,63),Bl:et(h,d,63)},c[2*e]=l,c[2*e+1]=u,c[2*t]=d,c[2*t+1]=h,c[2*r]=g,c[2*r+1]=w,c[2*o]=p,c[2*o+1]=y}function Ct(e,t={},r,o,i){if(st(r),e<0||e>r)throw new Error("outputLen bigger than keyLen");let{key:n,salt:a,personalization:s}=t;if(n!==void 0&&(n.length<1||n.length>r))throw new Error("key length must be undefined or 1.."+r);if(a!==void 0&&a.length!==o)throw new Error("salt must be undefined or "+o);if(s!==void 0&&s.length!==i)throw new Error("personalization must be undefined or "+i)}var pt=class extends ot{constructor(t,r){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,st(t),st(r),this.blockLen=t,this.outputLen=r,this.buffer=new Uint8Array(t),this.buffer32=H(this.buffer)}update(t){ft(this),t=R(t),V(t);let{blockLen:r,buffer:o,buffer32:i}=this,n=t.length,a=t.byteOffset,s=t.buffer;for(let l=0;l<n;){this.pos===r&&(P(i),this.compress(i,0,!1),P(i),this.pos=0);let u=Math.min(r-this.pos,n-l),d=a+l;if(u===r&&!(d%4)&&l+u<n){let h=new Uint32Array(s,d,Math.floor((n-l)/4));P(h);for(let g=0;l+r<n;g+=i.length,l+=r)this.length+=r,this.compress(h,g,!1);P(h);continue}o.set(t.subarray(l,l+u),this.pos),this.pos+=u,this.length+=u,l+=u}return this}digestInto(t){ft(this),kt(t,this);let{pos:r,buffer32:o}=this;this.finished=!0,L(this.buffer.subarray(r)),P(o),this.compress(o,0,!0),P(o);let i=H(t);this.get().forEach((n,a)=>i[a]=E(n))}digest(){let{buffer:t,outputLen:r}=this;this.digestInto(t);let o=t.slice(0,r);return this.destroy(),o}_cloneInto(t){let{buffer:r,length:o,finished:i,destroyed:n,outputLen:a,pos:s}=this;return t||(t=new this.constructor({dkLen:a})),t.set(...this.get()),t.buffer.set(r),t.destroyed=n,t.finished=i,t.length=o,t.pos=s,t.outputLen=a,t}clone(){return this._cloneInto()}},yt=class extends pt{constructor(t={}){let r=t.dkLen===void 0?64:t.dkLen;super(128,r),this.v0l=m[0]|0,this.v0h=m[1]|0,this.v1l=m[2]|0,this.v1h=m[3]|0,this.v2l=m[4]|0,this.v2h=m[5]|0,this.v3l=m[6]|0,this.v3h=m[7]|0,this.v4l=m[8]|0,this.v4h=m[9]|0,this.v5l=m[10]|0,this.v5h=m[11]|0,this.v6l=m[12]|0,this.v6h=m[13]|0,this.v7l=m[14]|0,this.v7h=m[15]|0,Ct(r,t,64,16,16);let{key:o,personalization:i,salt:n}=t,a=0;if(o!==void 0&&(o=R(o),a=o.length),this.v0l^=this.outputLen|a<<8|65536|1<<24,n!==void 0){n=R(n);let s=H(n);this.v4l^=E(s[0]),this.v4h^=E(s[1]),this.v5l^=E(s[2]),this.v5h^=E(s[3])}if(i!==void 0){i=R(i);let s=H(i);this.v6l^=E(s[0]),this.v6h^=E(s[1]),this.v7l^=E(s[2]),this.v7h^=E(s[3])}if(o!==void 0){let s=new Uint8Array(this.blockLen);s.set(o),this.update(s)}}get(){let{v0l:t,v0h:r,v1l:o,v1h:i,v2l:n,v2h:a,v3l:s,v3h:l,v4l:u,v4h:d,v5l:h,v5h:g,v6l:w,v6h:p,v7l:y,v7h:x}=this;return[t,r,o,i,n,a,s,l,u,d,h,g,w,p,y,x]}set(t,r,o,i,n,a,s,l,u,d,h,g,w,p,y,x){this.v0l=t|0,this.v0h=r|0,this.v1l=o|0,this.v1h=i|0,this.v2l=n|0,this.v2h=a|0,this.v3l=s|0,this.v3h=l|0,this.v4l=u|0,this.v4h=d|0,this.v5l=h|0,this.v5h=g|0,this.v6l=w|0,this.v6h=p|0,this.v7l=y|0,this.v7h=x|0}compress(t,r,o){this.get().forEach((l,u)=>c[u]=l),c.set(m,16);let{h:i,l:n}=xt(BigInt(this.length));c[24]=m[8]^n,c[25]=m[9]^i,o&&(c[28]=~c[28],c[29]=~c[29]);let a=0,s=Vt;for(let l=0;l<12;l++)S(0,4,8,12,t,r+2*s[a++]),T(0,4,8,12,t,r+2*s[a++]),S(1,5,9,13,t,r+2*s[a++]),T(1,5,9,13,t,r+2*s[a++]),S(2,6,10,14,t,r+2*s[a++]),T(2,6,10,14,t,r+2*s[a++]),S(3,7,11,15,t,r+2*s[a++]),T(3,7,11,15,t,r+2*s[a++]),S(0,5,10,15,t,r+2*s[a++]),T(0,5,10,15,t,r+2*s[a++]),S(1,6,11,12,t,r+2*s[a++]),T(1,6,11,12,t,r+2*s[a++]),S(2,7,8,13,t,r+2*s[a++]),T(2,7,8,13,t,r+2*s[a++]),S(3,4,9,14,t,r+2*s[a++]),T(3,4,9,14,t,r+2*s[a++]);this.v0l^=c[0]^c[16],this.v0h^=c[1]^c[17],this.v1l^=c[2]^c[18],this.v1h^=c[3]^c[19],this.v2l^=c[4]^c[20],this.v2h^=c[5]^c[21],this.v3l^=c[6]^c[22],this.v3h^=c[7]^c[23],this.v4l^=c[8]^c[24],this.v4h^=c[9]^c[25],this.v5l^=c[10]^c[26],this.v5h^=c[11]^c[27],this.v6l^=c[12]^c[28],this.v6h^=c[13]^c[29],this.v7l^=c[14]^c[30],this.v7h^=c[15]^c[31],L(c)}destroy(){this.destroyed=!0,L(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},F=Ut(e=>new yt(e));var ct={Argond2d:0,Argon2i:1,Argon2id:2},X=4,St=e=>e===void 0?Uint8Array.of():it(e);function gt(e,t){let r=e&65535,o=e>>>16,i=t&65535,n=t>>>16,a=Math.imul(r,i),s=Math.imul(o,i),l=Math.imul(r,n),u=Math.imul(o,n),d=(a>>>16)+(s&65535)+l,h=u+(s>>>16)+(d>>>16)|0,g=d<<16|a&65535;return{h,l:g}}function Gt(e,t){let{h:r,l:o}=gt(e,t);return{h:(r<<1|o>>>31)&4294967295,l:o<<1&4294967295}}function at(e,t,r,o){let{h:i,l:n}=Gt(t,o),a=J(t,o,n);return{h:W(a,e,r,i),l:a|0}}var b=new Uint32Array(256);function v(e,t,r,o){let i=b[2*e],n=b[2*e+1],a=b[2*t],s=b[2*t+1],l=b[2*r],u=b[2*r+1],d=b[2*o],h=b[2*o+1];({h:n,l:i}=at(n,i,s,a)),{Dh:h,Dl:d}={Dh:h^n,Dl:d^i},{Dh:h,Dl:d}={Dh:rt(h,d),Dl:nt(h,d)},{h:u,l}=at(u,l,h,d),{Bh:s,Bl:a}={Bh:s^u,Bl:a^l},{Bh:s,Bl:a}={Bh:C(s,a,24),Bl:G(s,a,24)},{h:n,l:i}=at(n,i,s,a),{Dh:h,Dl:d}={Dh:h^n,Dl:d^i},{Dh:h,Dl:d}={Dh:C(h,d,16),Dl:G(h,d,16)},{h:u,l}=at(u,l,h,d),{Bh:s,Bl:a}={Bh:s^u,Bl:a^l},{Bh:s,Bl:a}={Bh:tt(s,a,63),Bl:et(s,a,63)},b[2*e]=i,b[2*e+1]=n,b[2*t]=a,b[2*t+1]=s,b[2*r]=l,b[2*r+1]=u,b[2*o]=d,b[2*o+1]=h}function Tt(e,t,r,o,i,n,a,s,l,u,d,h,g,w,p,y){v(e,i,l,g),v(t,n,u,w),v(r,a,d,p),v(o,s,h,y),v(e,n,d,y),v(t,a,h,g),v(r,s,l,w),v(o,i,u,p)}function $(e,t,r,o,i){for(let n=0;n<256;n++)b[n]=e[t+n]^e[r+n];for(let n=0;n<128;n+=16)Tt(n,n+1,n+2,n+3,n+4,n+5,n+6,n+7,n+8,n+9,n+10,n+11,n+12,n+13,n+14,n+15);for(let n=0;n<16;n+=2)Tt(n,n+1,n+16,n+17,n+32,n+33,n+48,n+49,n+64,n+65,n+80,n+81,n+96,n+97,n+112,n+113);if(i)for(let n=0;n<256;n++)e[o+n]^=b[n]^e[t+n]^e[r+n];else for(let n=0;n<256;n++)e[o+n]=b[n]^e[t+n]^e[r+n];L(b)}function wt(e,t){let r=N(e),o=new Uint32Array(1),i=N(o);if(o[0]=t,t<=64)return F.create({dkLen:t}).update(i).update(r).digest();let n=new Uint8Array(t),a=F.create({}).update(i).update(r).digest(),s=0;for(n.set(a.subarray(0,32)),s+=32;t-s>64;s+=32){let l=F.create({}).update(a);l.digestInto(a),l.destroy(),n.set(a.subarray(0,32),s)}return n.set(F(a,{dkLen:t-s}),s),L(a,o),H(n)}function Nt(e,t,r,o,i,n,a=!1){let s;e===0?t===0?s=i-1:a?s=t*o+i-1:s=t*o+(i==0?-1:0):a?s=r-o+i-1:s=r-o+(i==0?-1:0);let l=e!==0&&t!==X-1?(t+1)*o:0,u=s-1-gt(s,gt(n,n).h).h;return(l+u)%r}var vt=Math.pow(2,32);function O(e){return Number.isSafeInteger(e)&&e>=0&&e<vt}function Rt(e){let t={version:19,dkLen:32,maxmem:vt-1,asyncTick:10};for(let[l,u]of Object.entries(e))u!=null&&(t[l]=u);let{dkLen:r,p:o,m:i,t:n,version:a,onProgress:s}=t;if(!O(r)||r<4)throw new Error("dkLen should be at least 4 bytes");if(!O(o)||o<1||o>=Math.pow(2,24))throw new Error("p should be 1 <= p < 2^24");if(!O(i))throw new Error("m should be 0 <= m < 2^32");if(!O(n)||n<1)throw new Error("t (iterations) should be 1 <= t < 2^32");if(s!==void 0&&typeof s!="function")throw new Error("progressCb should be function");if(!O(i)||i<8*o)throw new Error("memory should be at least 8*p bytes");if(a!==16&&a!==19)throw new Error("unknown version="+a);return t}function Ft(e,t,r,o){if(e=it(e),t=it(t),V(e),V(t),!O(e.length))throw new Error("password should be less than 4 GB");if(!O(t.length)||t.length<8)throw new Error("salt should be at least 8 bytes and less than 4 GB");if(!Object.values(ct).includes(r))throw new Error("invalid type");let{p:i,dkLen:n,m:a,t:s,version:l,key:u,personalization:d,maxmem:h,onProgress:g,asyncTick:w}=Rt(o);u=St(u),d=St(d);let p=F.create({}),y=new Uint32Array(1),x=N(y);for(let k of[i,n,a,s,l,r])y[0]=k,p.update(x);for(let k of[e,t,u,d])y[0]=k.length,p.update(x).update(k);let A=new Uint32Array(18),B=N(A);p.digestInto(B);let D=i,I=4*i*Math.floor(a/(X*i)),U=Math.floor(I/i),z=Math.floor(U/X),M=I*256;if(!O(h)||M>h)throw new Error("mem should be less than 2**32, got: maxmem="+h+", memused="+M);let dt=new Uint32Array(M);for(let k=0;k<i;k++){let Z=256*U*k;A[17]=k,A[16]=0,dt.set(wt(A,1024),Z),A[16]=1,dt.set(wt(A,1024),Z+256)}let mt=()=>{};if(g){let k=s*X*i*z,Z=Math.max(Math.floor(k/1e4),1),q=0;mt=()=>{q++,g&&(!(q%Z)||q===k)&&g(q/k)}}return L(y,A),{type:r,mP:I,p:i,t:s,version:l,B:dt,laneLen:U,lanes:D,segmentLen:z,dkLen:n,perBlock:mt,asyncTick:w}}function jt(e,t,r,o){let i=new Uint32Array(256);for(let a=0;a<t;a++)for(let s=0;s<256;s++)i[s]^=e[256*(r*a+r-1)+s];let n=N(wt(i,o));return L(i),n}function zt(e,t,r,o,i,n,a,s,l,u,d,h,g){u%a&&(d=u-1);let w,p;if(h){let B=n%128;B===0&&(t[268]++,$(t,256,2*256,0,!1),$(t,0,2*256,0,!1)),w=t[2*B],p=t[2*B+1]}else{let B=256*d;w=e[B],p=e[B+1]}let y=o===0&&i===0?r:p%l,x=Nt(o,i,a,s,n,w,y==r),A=a*y+x;$(e,256*d,256*A,u*256,g)}function Jt(e,t,r,o){let{mP:i,p:n,t:a,version:s,B:l,laneLen:u,lanes:d,segmentLen:h,dkLen:g,perBlock:w}=Ft(t,r,e,o),p=new Uint32Array(3*256);p[262]=i,p[264]=a,p[266]=e;for(let y=0;y<a;y++){let x=y!==0&&s===19;p[256]=y;for(let A=0;A<X;A++){p[260]=A;let B=e==ct.Argon2i||e==ct.Argon2id&&y===0&&A<2;for(let D=0;D<n;D++){p[258]=D,p[268]=0;let I=0;y===0&&A===0&&(I=2,B&&(p[268]++,$(p,256,2*256,0,!1),$(p,0,2*256,0,!1)));let U=D*u+A*h+I,z=U%u?U-1:U+u-1;for(let M=I;M<h;M++,U++,z++)w(),zt(l,p,D,y,A,M,u,h,d,U,z,B,x)}}}return L(p),jt(l,n,u,g)}var Ot=(e,t,r)=>Jt(ct.Argon2id,e,t,r);var Wt={iterations:3,parallelism:4,memorySize:2**16,hashLength:32,type:"id"};async function Y(e,t,r){let o={...Wt,...r};t||(t=crypto.getRandomValues(new Uint8Array(16)));let i;typeof e=="string"?i=new TextEncoder().encode(e):i=e;let n=Ot(i,t,{t:o.iterations,m:o.memorySize,p:o.parallelism}),a=await crypto.subtle.importKey("raw",n.slice(0,o.hashLength),{name:"AES-GCM"},!1,["encrypt","decrypt"]),s=await crypto.subtle.importKey("raw",n.slice(0,o.hashLength),{name:"HMAC",hash:"SHA-256"},!1,["sign","verify"]);return{encryptionKey:a,authKey:s,salt:t,key:a}}var It="AES-GCM";async function _(e,t){let r=crypto.getRandomValues(new Uint8Array(12)),o=JSON.stringify(e),i=new TextEncoder().encode(o),n=await crypto.subtle.encrypt({name:It,iv:r},t.encryptionKey,i);return{ciphertext:bt(new Uint8Array(n)),iv:bt(r),salt:bt(t.salt),algorithm:"AES-256-GCM",derivationAlgorithm:"Argon2id"}}async function lt(e,t){let r=Dt(e.ciphertext),o=Dt(e.iv);try{let i=await crypto.subtle.decrypt({name:It,iv:o},t.encryptionKey,r),n=new TextDecoder().decode(i);return JSON.parse(n)}catch{throw new Error("Decryption failed. This could be due to incorrect password or corrupted data.")}}function bt(e){let t="";for(let r=0;r<e.byteLength;r++)t+=String.fromCharCode(e[r]);return btoa(t)}function Dt(e){let t=atob(e),r=new Uint8Array(t.length);for(let o=0;o<t.length;o++)r[o]=t.charCodeAt(o);return r}var f={userId:null,derivedKey:null,decryptedVault:null,isLocked:!0,lastActivity:Date.now()},Xt=15*60*1e3,Mt="http://localhost:3001",j=null;function K(){f.lastActivity=Date.now(),j!==null&&clearTimeout(j),j=setTimeout(()=>{Ht()},Xt)}function Ht(){console.log("[Background] Locking vault and clearing sensitive data"),f.userId=null,f.derivedKey=null,f.decryptedVault=null,f.isLocked=!0,j!==null&&(clearTimeout(j),j=null),chrome.runtime.sendMessage({type:"VAULT_LOCKED"}).catch(()=>{})}chrome.runtime.onMessage.addListener((e,t,r)=>(console.log("[Background] Received message:",e.type),$t(e,t).then(r).catch(o=>{console.error("[Background] Error handling message:",o),r({success:!1,error:o.message})}),!0));async function $t(e,t){switch(e.type){case"UNLOCK_VAULT":return await Yt(e);case"ADD_PASSWORD":return await Zt(e);case"DELETE_PASSWORD":return await Qt(e);case"UPDATE_PASSWORD":return await te(e);case"GET_VAULT":return qt();case"LOCK_VAULT":return ee();case"GET_STATUS":return re();case"HEARTBEAT":return K(),{success:!0};default:return Promise.resolve({success:!1,error:"Unknown message type"})}}async function Yt(e){try{console.log("[Background] Unlocking vault for user:",e.userId);let t=await fetch(`${Mt}/api/vault/${e.userId}`);if(!t.ok){if(t.status===404){console.log("[Background] No vault found, creating new vault");let s=await Y(e.masterPassword),l=[],u=await _({site:"VAULT_ROOT",username:"SYSTEM",password:JSON.stringify(l)},s);return await ut(e.userId,u,[]),f.userId=e.userId,f.derivedKey=s,f.decryptedVault=l,f.isLocked=!1,K(),{success:!0}}throw new Error(`Backend error: ${t.statusText}`)}let r=await t.json(),o=ne(r.salt),i=await Y(e.masterPassword,o),n=await lt(r,i),a=JSON.parse(n.password);return f.userId=e.userId,f.derivedKey=i,f.decryptedVault=a,f.isLocked=!1,K(),console.log("[Background] Vault unlocked successfully"),{success:!0}}catch(t){return console.error("[Background] Failed to unlock vault:",t),f.userId=null,f.derivedKey=null,f.decryptedVault=null,f.isLocked=!0,{success:!1,error:t.message||"Failed to unlock vault. Check your master password."}}}async function Zt(e){if(f.isLocked||!f.derivedKey||!f.decryptedVault)return{success:!1,error:"Vault is locked"};try{f.decryptedVault.push(e.entry);let t=await _({site:"VAULT_ROOT",username:"SYSTEM",password:JSON.stringify(f.decryptedVault)},f.derivedKey),r=f.decryptedVault.map(o=>o.siteName);return await ut(f.userId,t,r),K(),{success:!0}}catch(t){return console.error("[Background] Failed to add password:",t),{success:!1,error:t.message}}}function qt(){return f.isLocked||!f.decryptedVault?{success:!1,error:"Vault is locked"}:(K(),{success:!0,vault:f.decryptedVault})}async function Qt(e){if(f.isLocked||!f.derivedKey||!f.decryptedVault)return{success:!1,error:"Vault is locked"};try{f.decryptedVault=f.decryptedVault.filter(o=>o.id!==e.entryId);let t=await _({site:"VAULT_ROOT",username:"SYSTEM",password:JSON.stringify(f.decryptedVault)},f.derivedKey),r=f.decryptedVault.map(o=>o.siteName);return await ut(f.userId,t,r),K(),{success:!0}}catch(t){return console.error("[Background] Failed to delete password:",t),{success:!1,error:t.message}}}async function te(e){if(f.isLocked||!f.derivedKey||!f.decryptedVault)return{success:!1,error:"Vault is locked"};try{let t=f.decryptedVault.findIndex(i=>i.id===e.entry.id);if(t===-1)return{success:!1,error:"Entry not found"};f.decryptedVault[t]={...e.entry,updatedAt:new Date().toISOString()};let r=await _({site:"VAULT_ROOT",username:"SYSTEM",password:JSON.stringify(f.decryptedVault)},f.derivedKey),o=f.decryptedVault.map(i=>i.siteName);return await ut(f.userId,r,o),K(),{success:!0}}catch(t){return console.error("[Background] Failed to update password:",t),{success:!1,error:t.message}}}function ee(){return Ht(),{success:!0}}function re(){return{isLocked:f.isLocked}}async function ut(e,t,r){let o=await fetch(`${Mt}/api/vault/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({encryptedVault:t,labels:r})});if(!o.ok)throw new Error(`Failed to save vault: ${o.statusText}`)}function ne(e){try{let t=atob(e),r=new Uint8Array(t.length);for(let o=0;o<t.length;o++)r[o]=t.charCodeAt(o);return r}catch(t){return console.error("[Background] Failed to decode base64:",t),new Uint8Array(0)}}chrome.runtime.onInstalled.addListener(()=>{console.log("[Background] Extension installed")});chrome.runtime.onStartup.addListener(()=>{console.log("[Background] Browser started - vault is locked by default")});console.log("[Background] Service worker initialized - vault is locked");
/*! Bundled license information:

@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)
*/
//# sourceMappingURL=background.js.map

var tt=BigInt(4294967295),xt=BigInt(32);function kt(e,t=!1){return t?{h:Number(e&tt),l:Number(e>>xt&tt)}:{h:Number(e>>xt&tt)|0,l:Number(e&tt)|0}}var K=(e,t,r)=>e>>>r|t<<32-r,C=(e,t,r)=>e<<32-r|t>>>r,et=(e,t,r)=>e<<64-r|t>>>r-32,rt=(e,t,r)=>e>>>r-32|t<<64-r,nt=(e,t)=>t,ot=(e,t)=>e;function ht(e,t,r,o){let i=(t>>>0)+(o>>>0);return{h:e+r+(i/2**32|0)|0,l:i|0}}var W=(e,t,r)=>(e>>>0)+(t>>>0)+(r>>>0),X=(e,t,r,o)=>t+r+o+(e/2**32|0)|0;function _t(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function it(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function U(e,...t){if(!_t(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function ft(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Bt(e,t){U(e);let r=t.outputLen;if(e.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function G(e){return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}function _(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function E(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}var Et=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Lt(e){return e<<24&4278190080|e<<8&16711680|e>>>8&65280|e>>>24&255}var L=Et?e=>e:e=>Lt(e);function Rt(e){for(let t=0;t<e.length;t++)e[t]=Lt(e[t]);return e}var R=Et?e=>e:Rt;function St(e){if(typeof e!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}function N(e){return typeof e=="string"&&(e=St(e)),U(e),e}function at(e){return typeof e=="string"&&(e=St(e)),U(e),e}var st=class{};function Ut(e){let t=(o,i)=>e(i).update(N(o)).digest(),r=e({});return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=o=>e(o),t}var Vt=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]);var b=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),c=new Uint32Array(32);function V(e,t,r,o,i,n){let a=i[n],s=i[n+1],l=c[2*e],u=c[2*e+1],d=c[2*t],h=c[2*t+1],g=c[2*r],w=c[2*r+1],p=c[2*o],y=c[2*o+1],x=W(l,d,a);u=X(x,u,h,s),l=x|0,{Dh:y,Dl:p}={Dh:y^u,Dl:p^l},{Dh:y,Dl:p}={Dh:nt(y,p),Dl:ot(y,p)},{h:w,l:g}=ht(w,g,y,p),{Bh:h,Bl:d}={Bh:h^w,Bl:d^g},{Bh:h,Bl:d}={Bh:K(h,d,24),Bl:C(h,d,24)},c[2*e]=l,c[2*e+1]=u,c[2*t]=d,c[2*t+1]=h,c[2*r]=g,c[2*r+1]=w,c[2*o]=p,c[2*o+1]=y}function T(e,t,r,o,i,n){let a=i[n],s=i[n+1],l=c[2*e],u=c[2*e+1],d=c[2*t],h=c[2*t+1],g=c[2*r],w=c[2*r+1],p=c[2*o],y=c[2*o+1],x=W(l,d,a);u=X(x,u,h,s),l=x|0,{Dh:y,Dl:p}={Dh:y^u,Dl:p^l},{Dh:y,Dl:p}={Dh:K(y,p,16),Dl:C(y,p,16)},{h:w,l:g}=ht(w,g,y,p),{Bh:h,Bl:d}={Bh:h^w,Bl:d^g},{Bh:h,Bl:d}={Bh:et(h,d,63),Bl:rt(h,d,63)},c[2*e]=l,c[2*e+1]=u,c[2*t]=d,c[2*t+1]=h,c[2*r]=g,c[2*r+1]=w,c[2*o]=p,c[2*o+1]=y}function Kt(e,t={},r,o,i){if(it(r),e<0||e>r)throw new Error("outputLen bigger than keyLen");let{key:n,salt:a,personalization:s}=t;if(n!==void 0&&(n.length<1||n.length>r))throw new Error("key length must be undefined or 1.."+r);if(a!==void 0&&a.length!==o)throw new Error("salt must be undefined or "+o);if(s!==void 0&&s.length!==i)throw new Error("personalization must be undefined or "+i)}var pt=class extends st{constructor(t,r){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,it(t),it(r),this.blockLen=t,this.outputLen=r,this.buffer=new Uint8Array(t),this.buffer32=_(this.buffer)}update(t){ft(this),t=N(t),U(t);let{blockLen:r,buffer:o,buffer32:i}=this,n=t.length,a=t.byteOffset,s=t.buffer;for(let l=0;l<n;){this.pos===r&&(R(i),this.compress(i,0,!1),R(i),this.pos=0);let u=Math.min(r-this.pos,n-l),d=a+l;if(u===r&&!(d%4)&&l+u<n){let h=new Uint32Array(s,d,Math.floor((n-l)/4));R(h);for(let g=0;l+r<n;g+=i.length,l+=r)this.length+=r,this.compress(h,g,!1);R(h);continue}o.set(t.subarray(l,l+u),this.pos),this.pos+=u,this.length+=u,l+=u}return this}digestInto(t){ft(this),Bt(t,this);let{pos:r,buffer32:o}=this;this.finished=!0,E(this.buffer.subarray(r)),R(o),this.compress(o,0,!0),R(o);let i=_(t);this.get().forEach((n,a)=>i[a]=L(n))}digest(){let{buffer:t,outputLen:r}=this;this.digestInto(t);let o=t.slice(0,r);return this.destroy(),o}_cloneInto(t){let{buffer:r,length:o,finished:i,destroyed:n,outputLen:a,pos:s}=this;return t||(t=new this.constructor({dkLen:a})),t.set(...this.get()),t.buffer.set(r),t.destroyed=n,t.finished=i,t.length=o,t.pos=s,t.outputLen=a,t}clone(){return this._cloneInto()}},yt=class extends pt{constructor(t={}){let r=t.dkLen===void 0?64:t.dkLen;super(128,r),this.v0l=b[0]|0,this.v0h=b[1]|0,this.v1l=b[2]|0,this.v1h=b[3]|0,this.v2l=b[4]|0,this.v2h=b[5]|0,this.v3l=b[6]|0,this.v3h=b[7]|0,this.v4l=b[8]|0,this.v4h=b[9]|0,this.v5l=b[10]|0,this.v5h=b[11]|0,this.v6l=b[12]|0,this.v6h=b[13]|0,this.v7l=b[14]|0,this.v7h=b[15]|0,Kt(r,t,64,16,16);let{key:o,personalization:i,salt:n}=t,a=0;if(o!==void 0&&(o=N(o),a=o.length),this.v0l^=this.outputLen|a<<8|65536|1<<24,n!==void 0){n=N(n);let s=_(n);this.v4l^=L(s[0]),this.v4h^=L(s[1]),this.v5l^=L(s[2]),this.v5h^=L(s[3])}if(i!==void 0){i=N(i);let s=_(i);this.v6l^=L(s[0]),this.v6h^=L(s[1]),this.v7l^=L(s[2]),this.v7h^=L(s[3])}if(o!==void 0){let s=new Uint8Array(this.blockLen);s.set(o),this.update(s)}}get(){let{v0l:t,v0h:r,v1l:o,v1h:i,v2l:n,v2h:a,v3l:s,v3h:l,v4l:u,v4h:d,v5l:h,v5h:g,v6l:w,v6h:p,v7l:y,v7h:x}=this;return[t,r,o,i,n,a,s,l,u,d,h,g,w,p,y,x]}set(t,r,o,i,n,a,s,l,u,d,h,g,w,p,y,x){this.v0l=t|0,this.v0h=r|0,this.v1l=o|0,this.v1h=i|0,this.v2l=n|0,this.v2h=a|0,this.v3l=s|0,this.v3h=l|0,this.v4l=u|0,this.v4h=d|0,this.v5l=h|0,this.v5h=g|0,this.v6l=w|0,this.v6h=p|0,this.v7l=y|0,this.v7h=x|0}compress(t,r,o){this.get().forEach((l,u)=>c[u]=l),c.set(b,16);let{h:i,l:n}=kt(BigInt(this.length));c[24]=b[8]^n,c[25]=b[9]^i,o&&(c[28]=~c[28],c[29]=~c[29]);let a=0,s=Vt;for(let l=0;l<12;l++)V(0,4,8,12,t,r+2*s[a++]),T(0,4,8,12,t,r+2*s[a++]),V(1,5,9,13,t,r+2*s[a++]),T(1,5,9,13,t,r+2*s[a++]),V(2,6,10,14,t,r+2*s[a++]),T(2,6,10,14,t,r+2*s[a++]),V(3,7,11,15,t,r+2*s[a++]),T(3,7,11,15,t,r+2*s[a++]),V(0,5,10,15,t,r+2*s[a++]),T(0,5,10,15,t,r+2*s[a++]),V(1,6,11,12,t,r+2*s[a++]),T(1,6,11,12,t,r+2*s[a++]),V(2,7,8,13,t,r+2*s[a++]),T(2,7,8,13,t,r+2*s[a++]),V(3,4,9,14,t,r+2*s[a++]),T(3,4,9,14,t,r+2*s[a++]);this.v0l^=c[0]^c[16],this.v0h^=c[1]^c[17],this.v1l^=c[2]^c[18],this.v1h^=c[3]^c[19],this.v2l^=c[4]^c[20],this.v2h^=c[5]^c[21],this.v3l^=c[6]^c[22],this.v3h^=c[7]^c[23],this.v4l^=c[8]^c[24],this.v4h^=c[9]^c[25],this.v5l^=c[10]^c[26],this.v5h^=c[11]^c[27],this.v6l^=c[12]^c[28],this.v6h^=c[13]^c[29],this.v7l^=c[14]^c[30],this.v7h^=c[15]^c[31],E(c)}destroy(){this.destroyed=!0,E(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},j=Ut(e=>new yt(e));var lt={Argond2d:0,Argon2i:1,Argon2id:2},$=4,Tt=e=>e===void 0?Uint8Array.of():at(e);function gt(e,t){let r=e&65535,o=e>>>16,i=t&65535,n=t>>>16,a=Math.imul(r,i),s=Math.imul(o,i),l=Math.imul(r,n),u=Math.imul(o,n),d=(a>>>16)+(s&65535)+l,h=u+(s>>>16)+(d>>>16)|0,g=d<<16|a&65535;return{h,l:g}}function Ct(e,t){let{h:r,l:o}=gt(e,t);return{h:(r<<1|o>>>31)&4294967295,l:o<<1&4294967295}}function ct(e,t,r,o){let{h:i,l:n}=Ct(t,o),a=W(t,o,n);return{h:X(a,e,r,i),l:a|0}}var m=new Uint32Array(256);function O(e,t,r,o){let i=m[2*e],n=m[2*e+1],a=m[2*t],s=m[2*t+1],l=m[2*r],u=m[2*r+1],d=m[2*o],h=m[2*o+1];({h:n,l:i}=ct(n,i,s,a)),{Dh:h,Dl:d}={Dh:h^n,Dl:d^i},{Dh:h,Dl:d}={Dh:nt(h,d),Dl:ot(h,d)},{h:u,l}=ct(u,l,h,d),{Bh:s,Bl:a}={Bh:s^u,Bl:a^l},{Bh:s,Bl:a}={Bh:K(s,a,24),Bl:C(s,a,24)},{h:n,l:i}=ct(n,i,s,a),{Dh:h,Dl:d}={Dh:h^n,Dl:d^i},{Dh:h,Dl:d}={Dh:K(h,d,16),Dl:C(h,d,16)},{h:u,l}=ct(u,l,h,d),{Bh:s,Bl:a}={Bh:s^u,Bl:a^l},{Bh:s,Bl:a}={Bh:et(s,a,63),Bl:rt(s,a,63)},m[2*e]=i,m[2*e+1]=n,m[2*t]=a,m[2*t+1]=s,m[2*r]=l,m[2*r+1]=u,m[2*o]=d,m[2*o+1]=h}function Ot(e,t,r,o,i,n,a,s,l,u,d,h,g,w,p,y){O(e,i,l,g),O(t,n,u,w),O(r,a,d,p),O(o,s,h,y),O(e,n,d,y),O(t,a,h,g),O(r,s,l,w),O(o,i,u,p)}function Y(e,t,r,o,i){for(let n=0;n<256;n++)m[n]=e[t+n]^e[r+n];for(let n=0;n<128;n+=16)Ot(n,n+1,n+2,n+3,n+4,n+5,n+6,n+7,n+8,n+9,n+10,n+11,n+12,n+13,n+14,n+15);for(let n=0;n<16;n+=2)Ot(n,n+1,n+16,n+17,n+32,n+33,n+48,n+49,n+64,n+65,n+80,n+81,n+96,n+97,n+112,n+113);if(i)for(let n=0;n<256;n++)e[o+n]^=m[n]^e[t+n]^e[r+n];else for(let n=0;n<256;n++)e[o+n]=m[n]^e[t+n]^e[r+n];E(m)}function wt(e,t){let r=G(e),o=new Uint32Array(1),i=G(o);if(o[0]=t,t<=64)return j.create({dkLen:t}).update(i).update(r).digest();let n=new Uint8Array(t),a=j.create({}).update(i).update(r).digest(),s=0;for(n.set(a.subarray(0,32)),s+=32;t-s>64;s+=32){let l=j.create({}).update(a);l.digestInto(a),l.destroy(),n.set(a.subarray(0,32),s)}return n.set(j(a,{dkLen:t-s}),s),E(a,o),_(n)}function Gt(e,t,r,o,i,n,a=!1){let s;e===0?t===0?s=i-1:a?s=t*o+i-1:s=t*o+(i==0?-1:0):a?s=r-o+i-1:s=r-o+(i==0?-1:0);let l=e!==0&&t!==$-1?(t+1)*o:0,u=s-1-gt(s,gt(n,n).h).h;return(l+u)%r}var vt=Math.pow(2,32);function v(e){return Number.isSafeInteger(e)&&e>=0&&e<vt}function Nt(e){let t={version:19,dkLen:32,maxmem:vt-1,asyncTick:10};for(let[l,u]of Object.entries(e))u!=null&&(t[l]=u);let{dkLen:r,p:o,m:i,t:n,version:a,onProgress:s}=t;if(!v(r)||r<4)throw new Error("dkLen should be at least 4 bytes");if(!v(o)||o<1||o>=Math.pow(2,24))throw new Error("p should be 1 <= p < 2^24");if(!v(i))throw new Error("m should be 0 <= m < 2^32");if(!v(n)||n<1)throw new Error("t (iterations) should be 1 <= t < 2^32");if(s!==void 0&&typeof s!="function")throw new Error("progressCb should be function");if(!v(i)||i<8*o)throw new Error("memory should be at least 8*p bytes");if(a!==16&&a!==19)throw new Error("unknown version="+a);return t}function jt(e,t,r,o){if(e=at(e),t=at(t),U(e),U(t),!v(e.length))throw new Error("password should be less than 4 GB");if(!v(t.length)||t.length<8)throw new Error("salt should be at least 8 bytes and less than 4 GB");if(!Object.values(lt).includes(r))throw new Error("invalid type");let{p:i,dkLen:n,m:a,t:s,version:l,key:u,personalization:d,maxmem:h,onProgress:g,asyncTick:w}=Nt(o);u=Tt(u),d=Tt(d);let p=j.create({}),y=new Uint32Array(1),x=G(y);for(let k of[i,n,a,s,l,r])y[0]=k,p.update(x);for(let k of[e,t,u,d])y[0]=k.length,p.update(x).update(k);let A=new Uint32Array(18),B=G(A);p.digestInto(B);let M=i,P=4*i*Math.floor(a/($*i)),S=Math.floor(P/i),z=Math.floor(S/$),H=P*256;if(!v(h)||H>h)throw new Error("mem should be less than 2**32, got: maxmem="+h+", memused="+H);let dt=new Uint32Array(H);for(let k=0;k<i;k++){let q=256*S*k;A[17]=k,A[16]=0,dt.set(wt(A,1024),q),A[16]=1,dt.set(wt(A,1024),q+256)}let At=()=>{};if(g){let k=s*$*i*z,q=Math.max(Math.floor(k/1e4),1),Q=0;At=()=>{Q++,g&&(!(Q%q)||Q===k)&&g(Q/k)}}return E(y,A),{type:r,mP:P,p:i,t:s,version:l,B:dt,laneLen:S,lanes:M,segmentLen:z,dkLen:n,perBlock:At,asyncTick:w}}function Ft(e,t,r,o){let i=new Uint32Array(256);for(let a=0;a<t;a++)for(let s=0;s<256;s++)i[s]^=e[256*(r*a+r-1)+s];let n=G(wt(i,o));return E(i),n}function Jt(e,t,r,o,i,n,a,s,l,u,d,h,g){u%a&&(d=u-1);let w,p;if(h){let B=n%128;B===0&&(t[268]++,Y(t,256,2*256,0,!1),Y(t,0,2*256,0,!1)),w=t[2*B],p=t[2*B+1]}else{let B=256*d;w=e[B],p=e[B+1]}let y=o===0&&i===0?r:p%l,x=Gt(o,i,a,s,n,w,y==r),A=a*y+x;Y(e,256*d,256*A,u*256,g)}function zt(e,t,r,o){let{mP:i,p:n,t:a,version:s,B:l,laneLen:u,lanes:d,segmentLen:h,dkLen:g,perBlock:w}=jt(t,r,e,o),p=new Uint32Array(3*256);p[262]=i,p[264]=a,p[266]=e;for(let y=0;y<a;y++){let x=y!==0&&s===19;p[256]=y;for(let A=0;A<$;A++){p[260]=A;let B=e==lt.Argon2i||e==lt.Argon2id&&y===0&&A<2;for(let M=0;M<n;M++){p[258]=M,p[268]=0;let P=0;y===0&&A===0&&(P=2,B&&(p[268]++,Y(p,256,2*256,0,!1),Y(p,0,2*256,0,!1)));let S=M*u+A*h+P,z=S%u?S-1:S+u-1;for(let H=P;H<h;H++,S++,z++)w(),Jt(l,p,M,y,A,H,u,h,d,S,z,B,x)}}}return E(p),Ft(l,n,u,g)}var It=(e,t,r)=>zt(lt.Argon2id,e,t,r);var Wt={iterations:3,parallelism:4,memorySize:2**16,hashLength:32,type:"id"};async function F(e,t,r){let o={...Wt,...r};t||(t=crypto.getRandomValues(new Uint8Array(16)));let i;typeof e=="string"?i=new TextEncoder().encode(e):i=e;let n=It(i,t,{t:o.iterations,m:o.memorySize,p:o.parallelism}),a=await crypto.subtle.importKey("raw",n.slice(0,o.hashLength),{name:"AES-GCM"},!1,["encrypt","decrypt"]),s=await crypto.subtle.importKey("raw",n.slice(0,o.hashLength),{name:"HMAC",hash:"SHA-256"},!1,["sign","verify"]);return{encryptionKey:a,authKey:s,salt:t,key:a}}var Mt="AES-GCM";async function I(e,t){let r=crypto.getRandomValues(new Uint8Array(12)),o=JSON.stringify(e),i=new TextEncoder().encode(o),n=await crypto.subtle.encrypt({name:Mt,iv:r},t.encryptionKey,i);return{ciphertext:mt(new Uint8Array(n)),iv:mt(r),salt:mt(t.salt),algorithm:"AES-256-GCM",derivationAlgorithm:"Argon2id"}}async function ut(e,t){let r=Dt(e.ciphertext),o=Dt(e.iv);try{let i=await crypto.subtle.decrypt({name:Mt,iv:o},t.encryptionKey,r),n=new TextDecoder().decode(i);return JSON.parse(n)}catch{throw new Error("Decryption failed. This could be due to incorrect password or corrupted data.")}}function mt(e){let t="";for(let r=0;r<e.byteLength;r++)t+=String.fromCharCode(e[r]);return btoa(t)}function Dt(e){let t=atob(e),r=new Uint8Array(t.length);for(let o=0;o<t.length;o++)r[o]=t.charCodeAt(o);return r}var f={userId:null,derivedKey:null,decryptedVault:null,isLocked:!0,lastActivity:Date.now()},Xt=15*60*1e3,bt="http://localhost:3001",J=null;function D(){f.lastActivity=Date.now(),J!==null&&clearTimeout(J),J=setTimeout(()=>{Pt()},Xt)}function Pt(){console.log("[Background] Locking vault and clearing sensitive data"),f.userId=null,f.derivedKey=null,f.decryptedVault=null,f.isLocked=!0,J!==null&&(clearTimeout(J),J=null),chrome.runtime.sendMessage({type:"VAULT_LOCKED"}).catch(()=>{})}chrome.runtime.onMessage.addListener((e,t,r)=>(console.log("[Background] Received message:",e.type),$t(e,t).then(r).catch(o=>{console.error("[Background] Error handling message:",o),r({success:!1,error:o.message})}),!0));async function $t(e,t){switch(e.type){case"UNLOCK_VAULT":return await Yt(e);case"ADD_PASSWORD":return await qt(e);case"DELETE_PASSWORD":return await te(e);case"UPDATE_PASSWORD":return await ee(e);case"GET_VAULT":return Qt();case"LOCK_VAULT":return re();case"GET_STATUS":return ne();case"HEARTBEAT":return D(),{success:!0};case"REGISTER_USER":return await Zt(e);default:return Promise.resolve({success:!1,error:"Unknown message type"})}}async function Yt(e){try{console.log("[Background] Unlocking vault for user:",e.userId);let t=await fetch(`${bt}/api/vault/${e.userId}`);if(!t.ok){if(t.status===404){console.log("[Background] No vault found, creating new vault");let s=await F(e.masterPassword),l=[],u=await I({site:"VAULT_ROOT",username:"SYSTEM",password:JSON.stringify(l)},s);return await Z(e.userId,u,[]),f.userId=e.userId,f.derivedKey=s,f.decryptedVault=l,f.isLocked=!1,D(),{success:!0}}throw new Error(`Backend error: ${t.statusText}`)}let r=await t.json(),o=oe(r.salt),i=await F(e.masterPassword,o),n=await ut(r,i),a=JSON.parse(n.password);return f.userId=e.userId,f.derivedKey=i,f.decryptedVault=a,f.isLocked=!1,D(),console.log("[Background] Vault unlocked successfully"),{success:!0}}catch(t){return console.error("[Background] Failed to unlock vault:",t),f.userId=null,f.derivedKey=null,f.decryptedVault=null,f.isLocked=!0,{success:!1,error:t.message||"Failed to unlock vault. Check your master password."}}}async function Zt(e){try{console.log("[Background] Registering new user:",e.email);let t=crypto.getRandomValues(new Uint8Array(16)),r=await F(e.masterPassword,t),i=new TextEncoder().encode("auth-proof"),n=await crypto.subtle.sign("HMAC",r.authKey,i),a=Array.from(new Uint8Array(n)).map(g=>g.toString(16).padStart(2,"0")).join(""),s=Array.from(t).map(g=>g.toString(16).padStart(2,"0")).join(""),l=await fetch(`${bt}/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e.email,salt:s,verifier:a})});if(!l.ok){let g=await l.json();throw new Error(g.message||g.error||"Registration failed")}let u=await l.json();console.log("[Background] User registered successfully, ID:",u.userId);let d=[],h=await I({site:"VAULT_ROOT",username:"SYSTEM",password:JSON.stringify(d)},r);return await Z(e.email,h,[]),f.userId=e.email,f.derivedKey=r,f.decryptedVault=d,f.isLocked=!1,D(),{success:!0}}catch(t){return console.error("[Background] Registration failed:",t),{success:!1,error:t.message}}}async function qt(e){if(f.isLocked||!f.derivedKey||!f.decryptedVault)return{success:!1,error:"Vault is locked"};try{f.decryptedVault.push(e.entry);let t=await I({site:"VAULT_ROOT",username:"SYSTEM",password:JSON.stringify(f.decryptedVault)},f.derivedKey),r=f.decryptedVault.map(o=>o.siteName);return await Z(f.userId,t,r),D(),{success:!0}}catch(t){return console.error("[Background] Failed to add password:",t),{success:!1,error:t.message}}}function Qt(){return f.isLocked||!f.decryptedVault?{success:!1,error:"Vault is locked"}:(D(),{success:!0,vault:f.decryptedVault})}async function te(e){if(f.isLocked||!f.derivedKey||!f.decryptedVault)return{success:!1,error:"Vault is locked"};try{f.decryptedVault=f.decryptedVault.filter(o=>o.id!==e.entryId);let t=await I({site:"VAULT_ROOT",username:"SYSTEM",password:JSON.stringify(f.decryptedVault)},f.derivedKey),r=f.decryptedVault.map(o=>o.siteName);return await Z(f.userId,t,r),D(),{success:!0}}catch(t){return console.error("[Background] Failed to delete password:",t),{success:!1,error:t.message}}}async function ee(e){if(f.isLocked||!f.derivedKey||!f.decryptedVault)return{success:!1,error:"Vault is locked"};try{let t=f.decryptedVault.findIndex(i=>i.id===e.entry.id);if(t===-1)return{success:!1,error:"Entry not found"};f.decryptedVault[t]={...e.entry,updatedAt:new Date().toISOString()};let r=await I({site:"VAULT_ROOT",username:"SYSTEM",password:JSON.stringify(f.decryptedVault)},f.derivedKey),o=f.decryptedVault.map(i=>i.siteName);return await Z(f.userId,r,o),D(),{success:!0}}catch(t){return console.error("[Background] Failed to update password:",t),{success:!1,error:t.message}}}function re(){return Pt(),{success:!0}}function ne(){return{isLocked:f.isLocked}}async function Z(e,t,r){let o=await fetch(`${bt}/api/vault/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({encryptedVault:t,labels:r})});if(!o.ok)throw new Error(`Failed to save vault: ${o.statusText}`)}function oe(e){try{let t=atob(e),r=new Uint8Array(t.length);for(let o=0;o<t.length;o++)r[o]=t.charCodeAt(o);return r}catch(t){return console.error("[Background] Failed to decode base64:",t),new Uint8Array(0)}}chrome.runtime.onInstalled.addListener(()=>{console.log("[Background] Extension installed")});chrome.runtime.onStartup.addListener(()=>{console.log("[Background] Browser started - vault is locked by default")});console.log("[Background] Service worker initialized - vault is locked");
/*! Bundled license information:

@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)
*/
//# sourceMappingURL=background.js.map
